<!DOCTYPE html>
<html lang="en">
<body>
	<apex:page showHeader="false" sidebar="false" applyBodyTag="false" docType="html-5.0">
    <script type='text/javascript'>
	function initEmbeddedMessaging() {
		try {
			embeddedservice_bootstrap.settings.language = 'en_US'; // For example, enter 'en' or 'en-US'

			embeddedservice_bootstrap.init(
				'00Dak00000XwTZn',
				'Web',
				'https://gerentllc-d-dev-ed.develop.my.site.com/ESWWeb1757243067568',
				{
					scrt2URL: 'https://gerentllc-d-dev-ed.develop.my.salesforce-scrt.com'
				}
			);
		} catch (err) {
			console.error('Error loading Embedded Messaging: ', err);
		}
	};
</script>
     <script type="text/javascript">
        var jWTFromApex; 
        function callApexMethod() {
            JWTGenerateToken.generateJWT(function(result, event) {
                if (event.status) {
                    console.log('Generated JWT : ' +result);
                    jWTFromApex = result;
                } else {
                    console.error(event.message);
                }
            });
        }
    </script>
 <script type='text/javascript'>
	window.addEventListener("onEmbeddedMessagingReady", () => {
  console.log("Received the onEmbeddedMessagingReady event.");

  callApexMethod(); // <-- generate JWT first

  // Delay until JWT is ready
  setTimeout(() => {
    embeddedservice_bootstrap.userVerificationAPI.setIdentityToken({
      identityTokenType: "JWT",
      identityToken: jWTFromApex
    });
  }, 1000);
});
</script>
<script type='text/javascript' src='https://gerentllc-d-dev-ed.develop.my.site.com/ESWWeb1757243067568/assets/js/bootstrap.min.js' onload='initEmbeddedMessaging()'></script>
</apex:page>
</body>
</html>
